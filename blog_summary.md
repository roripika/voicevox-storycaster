### VOICEVOX エンジンをワンコマンドでセットアップしたい
---------------------------------
[VOICEVOXアプリをテキストから自動音声化できる仕組みを作りたい。まずインストールスクリプトを。]
{VOICEVOXエンジンの最新リリースを取得・展開し、依存ツール確認や自動導入、展開先シンボリックリンク作成までを行う `scripts/install_voicevox_engine.sh` を作成。README へ利用方法も追記。}
補足
---------------------------------

### Geminiプロバイダ利用時のエラー対応
---------------------------------
[設定画面でGeminiを選び、必要パッケージをインストール後に音声生成したらプロセスが失敗。]
{Geminiクライアントの初期化でpipインストール直後に認識されるよう修正し、OPENAIキーの強制チェックを解除。さらに`gemini-1.5-flash-latest`など有効なモデルへ差し替えGUIの候補リストも更新、保存されたAPIキーを実行環境へ渡すようにして404エラーを解消。}
補足
---------------------------------

### 話者ごとの情報を一覧化したい
---------------------------------
[VOICEVOXで利用可能な話者一覧を出力したい。詳細情報も欲しい。]
{エンジンから `/speakers` を取得して md/csv/json で出力する `scripts/export_voicevox_speakers.sh` を追加。`--details` で `/speaker_info` を収集しJSON保存できるよう対応。README に出力手順を記載。}
補足
---------------------------------

### 小説を読み込んで自動で配役し音声化するパイプラインが欲しい
---------------------------------
[テキストをAIに渡し、キャラクター推定→VOICEVOX配役→音声生成まで自動化したい。]
{`scripts/novel_to_voicevox.py` と `config/voice_assignments.yaml` を整備し、OpenAIを使った発話割当とVOICEXOX合成を実装。READMEに実行手順を追加。}
補足
---------------------------------

### VOICEVOX話者の担当一覧を作りたい
---------------------------------
[抽出された話者ごとのプロフィールをYAMLにまとめたい。]
{`scripts/export_voicevox_speakers.sh` の出力を基に `config/voice_assignments.yaml` に猫使アル等のプロフィール例を追記し、READMEで使い方を説明。}
補足
---------------------------------

### 登場人物抽出→配役→音声合成を完全自動化したい
---------------------------------
[AIがキャラを抽出し、自動でVOICEVOXスタイルIDと紐づけて音声合成するスクリプトが欲しい。]
{`scripts/auto_assign_voicevox.py` を追加し、LLMでキャラクター抽出→VOICEVOX話者マッピング→YAML生成→音声合成まで一括実行。READMEに手順を追記。}
補足
---------------------------------

### AIが割り当てたキャラの音声出力がナレーションだけになる
---------------------------------
[すべてナレーション扱いになり音声が生成されないので直したい。]
{自動割当YAMLへナレーション枠（style_id=3）を必ず追加するロジックを実装し、地の文も音声化できるよう修正。}
補足
---------------------------------

### 生成した行単位音声を一本化したい
---------------------------------
[manifestを使ってWAVを結合するスクリプトが欲しい。]
{`scripts/merge_voicevox_audio.py` を追加し、ffmpeg concatで1本のWAVにまとめられるようにした。READMEにも手順を追加。}
補足
---------------------------------

### GUIでテキスト貼り付け→実行できるようにしたい
---------------------------------
[初心者向けに、テキスト入力と実行ボタンだけで済むGUIランチャーが欲しい。]
{Tkinterベースの `scripts/gui_voicevox_runner.py` を作成し、テキスト貼付→音声生成→フォルダ表示まで自動化。READMEにGUIの使い方も記載。}
補足
---------------------------------

### セットアップやGUIをワンクリックで起動したい（mac）
---------------------------------
[Finderからダブルクリックでセットアップ・GUIが起動する .command を用意してほしい。]
{`SetupVoicevoxEnvironment.command` と `RunVoicevoxGUI.command` を追加し、`.venv` 読み込みやOpenAIキー設定も自動化。READMEで案内。}
補足
---------------------------------

### WSL環境の利用者向けインストーラが欲しい
---------------------------------
[Windowsの初心者でもWSL＋依存ツールを一括で整えたい。]
{管理者PowerShell用 `SetupWSL.ps1` を追加し、WSL2・Ubuntu導入と基本パッケージのインストールを自動化。READMEに手順を追記。}
補足
---------------------------------

### Windows用のワンクリックセットアップ／GUIランチャーが欲しい
---------------------------------
[WSLを使っていてもWindows側からダブルクリックでセットアップ・GUIを呼び出したい。]
{`SetupVoicevoxEnvironment_win.ps1` と `RunVoicevoxGUI_win.ps1` を追加し、PowerShellからWSL内でセットアップやGUI起動を実行できるようにした。READMEで案内。}
補足
---------------------------------

### Gemeni や他APIへ切り替えられるようにしたい
---------------------------------
[OpenAI以外のAPIにも対応させたい。]
{LLMクライアントを抽象化する `scripts/llm_client.py` を追加し、OpenAI／Anthropic／Geminiを`--llm-provider`で切り替え可能に改修。READMEも更新。}
補足
---------------------------------

### CLIのGemini対応でエラーが出る
---------------------------------
[Gemini指定時に未インストール扱いが続く＆キーの設定ができない。]
{Geminiクライアントのインデントバグを修正し、GUI設定から必要パッケージ導入→キャッシュ無効化→再判定を行うよう改善。設定ウィンドウにAPIキー入力欄とウォーターマークを追加し、保存・呼び出しにも対応。}
補足
---------------------------------

### READMEの対応OS条件と概要をわかりやすく
---------------------------------
[ツールの概要と対応OSを初心者向けに明記してほしい。]
{README冒頭に「AIがキャラクターを推定してVOICEVOXへ自動配役し音声生成するツール」であること、生成物一覧、対応OS（macOS/Linux/WSL必須のWindows10/11）を追記。}
補足
---------------------------------

### 生成された成果物やAPI配役を詳しく説明してほしい
---------------------------------
[README冒頭で出力ファイルの説明や配役システムを紹介したい。]
{結合済みWAV、行ごとのWAV、assignments.jsonl、manifest、voice_assignments_auto.yaml など生成結果の説明を追加。}
補足
---------------------------------

### README に設定画面の説明を載せたい
---------------------------------
[GUI設定ボタンからLLMを切り替えられる旨を明記したい。]
{クイックスタートに設定ボタンと `config/llm_settings.json` への保存について追記。}
補足
---------------------------------

### WSL未利用のWindowsで必要な追加対応の説明
---------------------------------
[Windows 10以前についての案内を追加したい。]
{READMEに「WSL対応のWin10/11向け手順」を追記し、WSLが使えない場合は現在サポート外である旨を明記。}
補足
---------------------------------

### 既存コミットの著者名をハンドルネームに変更したい
---------------------------------
[個人名でコミットしてしまったので“roripika”名義に変えたい。]
{Git設定を `user.name=roripika` / `user.email=...` に変更し、最新コミットを --amend で上書き。}
補足
---------------------------------

### リポジトリを GitHub へ初回プッシュしたい
---------------------------------
[ローカルから `voicevox-storycaster` リポジトリへ push したい。]
{必要なファイルを `.gitignore` 整理の上で初期コミットし、`git push origin master` に成功（途中の大容量JSONは除外）。}
補足
---------------------------------

### READMEに動作可能OSの条件を追記したい
---------------------------------
[サポートOSを冒頭で明記したい。]
{macOS12+, Ubuntu20.04+, Windows10/11（WSL2+WSLg必須）を README 冒頭に追加。}
補足
---------------------------------

### Gemini CLI利用時に不足パッケージを自動案内・インストールしたい
---------------------------------
[設定画面でプロバイダ未インストール表示が消えないのを改善したい。]
{インストール後に importlib キャッシュを無効化し再判定できるよう修正、成功／失敗のフィードバックを追加。}
補足
---------------------------------

### 設定画面でGeminiパッケージが未インストール表示のまま
---------------------------------
[Geminiを選択し必要パッケージをインストールしても「未インストール: google-generativeai」が消えない。]
{チェック処理をモジュール名ベースに変え、インストール直後に importlib キャッシュを無効化して即座に解消するよう改善。}
補足
---------------------------------

### 「未インストール」表示が解消されない最終対応
---------------------------------
[改善後も再表示で未インストール扱いになる。]
{Gemini依存チェックでパッケージとモジュールを分けて評価し、キャッシュ無効化後に即座に判定させるよう再修正。blog_summary にも対応内容を追記。}
補足
---------------------------------

### GUI設定からAPIキー入力欄を設け、保存・復元したい
---------------------------------
[設定画面にAPIキー入力フィールドを用意し、プロバイダに応じてウォーターマーク表示、保存したキーを使うようにしたい。]
{設定画面にAPIキー欄を追加し、プロバイダ切り替えで既存キーや環境変数を初期表示、未設定時は「未設定」のウォーターマークを表示。保存したキーは `config/llm_settings.json` に書き込み、音声生成時には環境変数として渡すよう改修。}
補足
---------------------------------

### LLMプロバイダ設定を外部ファイル化しGemini無料枠モデルをフォロー
---------------------------------
[今後モデルが変わることを想定してプロバイダ/モデル一覧をコードから切り離し、無料枠モデルの案内も表示したい。]
{`config/llm_providers.yaml` を追加し、GUI設定画面で動的にプロバイダとモデルを読み込むよう改修。Gemini には `gemini-2.5-flash` / `gemini-2.5-flash-lite` を含め、ノート表示で無料枠のモデルを案内するようにした。依存チェックもコンフィグに基づいて実行。}
補足
---------------------------------

### CLI実行時にモジュールが見つからない問題を解消したい
---------------------------------
[`.command` や絶対パス経由でスクリプトを起動すると `ModuleNotFoundError: scripts` になる。]
{`auto_assign_voicevox.py` / `novel_to_voicevox.py` の先頭でリポジトリルートを `sys.path` に追加し、どの実行方法でも `scripts.llm_client` をインポートできるようにした。README には Finder 実行時は GUI 設定で API キーを登録する旨も追記。}
補足
---------------------------------

### Gemini利用時の出力打ち切り対策とトークン調整オプションが欲しい
---------------------------------
[Gemini 2.5 Flash が JSON を途中で切る／finish_reason=2 になるので再現性高く失敗する。]
{Gemini向けプロンプトを厳密化し、LLM クライアントで `candidates[].content.parts` を安全に取り出すよう修正。さらに `auto_assign_voicevox.py` / `novel_to_voicevox.py` に最大出力トークン指定オプションを追加し、README にチューニング方法を記載。}
補足
---------------------------------

### 長文のチャンク分割精度を上げてオーバーラップさせたい
---------------------------------
[段落単位だと文が途中で切れたり、チャンクごとに話者推定がぶれる。]
{`novel_to_voicevox.py` を文単位分割＋指定文字数で再結合する方式へ変更し、`--chunk-overlap-sentences` で末尾文を次チャンクへ持ち越すよう対応。重複する文の話者・種別は先行チャンクの結果を優先する整合性チェックを追加。}
補足
---------------------------------
